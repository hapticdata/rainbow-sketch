define(["require","exports","module","underscore","./loop","./colors","./curves","toxi/geom/Vec2D"],function(t){var e=(t("underscore"),t("./loop")),i=t("./colors"),n=t("./curves"),r=t("toxi/geom/Vec2D");return function(t,s){return function(o,a){var h=n.previous(),u=n.next();s.verbose&&console.log("operation ("+n.operations.indexOf(u)+"): ",u.angles," counter: "+u.counterClockwise+" next: "+u.next);var l=(u.angles[1]-u.angles[0])/s.resolution,c=u.angles[0];return new r(s.radius,u.angles[1]).toCartesian(),h&&u.counterClockwise!==h.counterClockwise&&o.addSelf(new r(2*s.radius,h.angles[1]).toCartesian()),e(function(e,n){t.lineWidth=s.lineWidth,t.lineCap="square";var r=c+l,h=function(e,i){t.strokeStyle=i,t.beginPath(),t.arc(o.x,o.y,e,c,r,u.counterClockwise),t.stroke(),t.closePath()},d=i.values.slice(0);u.counterClockwise&&d.reverse(),h(s.radius+2*s.lineWidth+2*s.spacing,d[0]),h(s.radius+s.lineWidth+s.spacing,d[1]),h(s.radius,d[2]),h(s.radius-(s.lineWidth+s.spacing),d[3]),h(s.radius-(2*s.lineWidth+2*s.spacing),d[4]),c=r,e===s.resolution&&(n(),a&&a())}).start()}}});