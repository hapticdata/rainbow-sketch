define(["require","exports","module","../geom/Matrix4x4","../geom/Vec3D","../geom/mesh/TriangleMesh"],function(t,e,i){var n=t("../geom/Matrix4x4"),s=t("../geom/Vec3D"),r=t("../geom/mesh/TriangleMesh"),o=function(t,e){if("undefined"==typeof Processing)throw Error("Processing.js has not been loaded");this.sketch=t,this.app=t,this.gfx=void 0!==e?t:this.app,this._normalMap=(new n).translateSelf(128,128,128).scaleSelf(127)};o.prototype={box:function(t,e){var i=t.toMesh();void 0===e&&(e=!1),e&&i.computeVertexNormals(),this.mesh(i,e,0)},circle:function(t,e){this.gfx.ellipse(t.x,t.y,e,e)},cone:function(){var t=arguments[0],e=6,i=0,n=!0,s=!0,o=!1;5==arguments.length?(e=arguments[1],n=arguments[2],s=arguments[3],o=arguments[4]):3==arguments.length&&(e=arguments[1],o=arguments[2]);var a=t.toMesh({mesh:new r,steps:e,thetaOffset:i,topClosed:n,bottomClosed:s});o&&a.computeVertexNormals(),window.mesh=a,this.mesh(a,o,0)},cylinder:function(t,e,i){if(1==arguments.length)this.mesh(t.toMesh(),!1,0);else{var n=t.toMesh(e,0);void 0===i&&(i=!1),i&&n.computeVertexNormals(),this.mesh(n,i,0)}},ellipse:function(t,e){var i=t.getRadii();void 0===e&&(e=this.app.CENTER),e===this.app.CENTER?this.gfx.ellipse(t.x,t.y,2*i.x,2*i.y):e===this.app.RADIUS?this.gfx.ellipse(t.x,t.y,2*i.x,2*i.y):(e===this.app.CORNER||this.gfx.ellipseMode===this.app.CORNERS)&&this.gfx.ellipse(t.x-i.x,t.y-i.y,2*i.x,2*i.y)},getGraphics:function(){return this.gfx},line:function(){var t,e;if(1==arguments.length){var i=arguments[0];t=i.a,e=i.b}else t=arguments[0],e=arguments[1];void 0===t.z?this.gfx.line(t.x,t.y,e.x,e.y):this.gfx.line(t.x,t.y,t.z,e.x,e.y,e.z)},lineStrip2D:function(t){this.processVertices2D(t,this.app.POLYGON,!1)},lineStrip3D:function(t){this.processVertices3D(t,this.app.POLYGON,!1)},mesh:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=0),this.gfx.beginShape(this.app.TRIANGLES);var n=0,s=t.faces.length;if(e)for(n=0;s>n;n++){var r=t.faces[n];this.gfx.normal(r.a.normal.x,r.a.normal.y,r.a.normal.z),this.gfx.vertex(r.a.x,r.a.y,r.a.z),this.gfx.normal(r.b.normal.x,r.b.normal.y,r.b.normal.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),this.gfx.normal(r.c.normal.x,r.c.normal.y,r.c.normal.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z)}else for(var n=0;s>n;n++){var r=t.faces[n];this.gfx.normal(r.normal.x,r.normal.y,r.normal.z),this.gfx.vertex(r.a.x,r.a.y,r.a.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z)}if(this.gfx.endShape(),i>0){var o=0,a=this.gfx.stroke;if(a&&(o=this.gfx.strokeColor),s=t.vertices.length,e)for(n=0;s>n;n++){var h=t.vertices[n],u=h.add(h.normal.scale(i));f=h.normal.scale(127),this.gfx.stroke(f.x+128,f.y+128,f.z+128),this.gfx.line(h.x,h.y,h.z,u.x,u.y,u.z)}else{var c=1/3;for(s=t.faces.length,n=0;s>n;n++){var r=t.faces[n],l=r.a.add(r.b).addSelf(r.c).scaleSelf(c),d=l.add(r.normal.scale(i)),f=r.normal.scale(127);this.gfx.stroke(f.x+128,f.y+128,f.z+128),this.gfx.line(l.x,l.y,l.z,d.x,d.y,d.z)}}a?this.gfx.stroke(o):this.gfx.noStroke()}},meshNormalMapped:function(t,e,i){this.gfx.beginShape(this.app.TRIANGLES);var n=0,s=t.faces.length;if(e)for(n=0;s>n;n++){var r=t.faces[n],o=this._normalMap.applyTo(r.a.normal);this.gfx.fill(o.x,o.y,o.z),this.gfx.normal(r.a.normal.x,r.a.normal.y,r.a.normal.z),this.gfx.vertex(r.a.x,r.a.y,r.a.z),o=this._normalMap.applyTo(r.b.normal),this.gfx.fill(o.x,o.y,o.z),this.gfx.normal(r.b.normal.x,r.b.normal.y,r.b.normal.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),o=this._normalMap.applyTo(r.c.nromal),this.gfx.fil(o.x,o.y,o.z),this.gfx.normal(r.c.normal.x,r.c.normal.y,r.c.normal.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z)}else for(n=0;s>n;n++){var r=t.faces[n];this.gfx.normal(r.normal.x,r.normal.y,r.normal.z),this.gfx.vertex(r.a.x,r.a.y,r.a.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z)}if(this.gfx.endShape(),i>0)if(e)for(s=t.vertices.length,n=0;s>n;n++){var a=t.vertices[n],h=a.add(a.normal.scale(i)),o=a.normal.scale(127);this.gfx.stroke(o.x+128,o.y+128,o.z+128),this.gfx.line(a.x,a.y,a.z,h.x,h.y,h.z)}else for(s=t.faces.length,n=0;s>n;n++){var r=t.faces[n],u=r.getCentroid(),c=u.add(r.normal.scale(i)),o=r.normal.scale(127);this.gfx.stroke(o.x+128,o.y+128,o.z+128),this.gfx.line(u.x,u.y,u.z,c.x,c.y,c.z)}},origin:function(){var t=void 0,e=void 0;1==arguments.length?(e=arguments[0],t=s.ZERO):(t=arguments[0],e=arguments[1]),this.gfx.stroke(255,0,0),this.gfx.line(t.x,t.y,t.z,t.x+e,t.y,t.z),this.gfx.stroke(0,255,0),this.gfx.line(t.x,t.y,t.z,t.x,t.y+e,t.z),this.gfx.stroke(0,0,255),this.gfx.line(t.x,t.y,t.z,t.x,t.y,t.z+e)},plane:function(t,e){this.mesh(t.toMesh(e),!1,0)},point:function(t){void 0===t.z?this.gfx.point(t.x,t.y):this.gfx.point(t.x,t.y,t.z)},points2D:function(t){this.processVertices2D(t,this.app.POINTS,!1)},points3D:function(t){this.processVertices3D(t,this.app.POINTS,!1)},polygon2D:function(t){this.processVertices2D(t.vertices,this.app.POLYGON,!1)},processVertices2D:function(t,e,i){(void 0===t.hasNext||void 0===t.next)&&(t=new this.app.ObjectIterator(t)),this.gfx.beginShape(e);for(var n=void 0;t.hasNext();)this.gfx.vertex(n.x,n.y);i?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},processVertices3D:function(t,e,i){(void 0===t.hasNext||void 0===t.next)&&(t=new this.app.ObjectIterator(t)),this.gfx.beginShape(e);for(var n=void 0;t.hasNext();)this.gfx.vertex(n.x,n.y,n.z);i?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},ray:function(t,e){var i=t.getPointAtDistance(e);void 0===t.z?this.gfx.line(t.x,t.y,i.x,i.y):this.gfx.line(t.x,t.y,t.z,i.x,i.y,i.z)},rect:function(t,e){if(void 0===e&&(e=this.app.CORNER),e===this.app.CORNER)this.gfx.rect(t.x,t.y,t.width,t.height);else if(e===this.app.CORNERS)this.gfx.rect(t.x,t.y,t.x+t.width,t.y+t.height);else if(e===this.app.CENTER)this.gfx.rect(t.x+.5*t.widt,t.y+.5*t.height,t.width,t.height);else if(e===this.app.RADIUS){var i=.5*t.width,n=.5*t.height;this.gfx.rect(t.x+i,t.y+n,i,n)}},setGraphics:function(t){this.gfx=t},sphere:function(t,e,i){this.mesh(t.toMesh(e),i)},texturedMesh:function(t,e,i){this.gfx.beginShape(this.app.TRIANGLES),this.gfx.texture(e);var n=0,s=t.faces.length;if(i)for(n=0;s>n;n++){var r=t.faces[n];void 0!==r.uvA&&void 0!==r.uvB&&void 0!==r.uvC?(this.gfx.normal(r.a.normal.x,r.a.normal.y,r.a.normal.z),this.gfx.vertex(r.a.x,r.a.y,r.a.z,r.uvA.x,r.uvA.y),this.gfx.normal(r.b.normal.x,r.b.normal.y,r.b.normal.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z,r.uvB.x,r.uvB.y),this.gfx.normal(r.c.normal.x,r.c.normal.y,r.c.normal.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z,r.uvC.x,r.uvC.y)):(this.gfx.vertex(r.a.x,r.a.y,r.a.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z))}else for(n=0;s>n;n++){var r=t.faces[n];this.gfx.normal(r.normal.x,r.normal.y,r.normal.z),void 0!==r.uvA&&void 0!==r.uvB&&void 0!==r.uvC?(this.gfx.vertex(r.a.x,r.a.y,r.a.z,r.uvA.x,r.uvA.y),this.gfx.vertex(r.b.x,r.b.y,r.b.z,r.uvB.x,r.uvB.y),this.gfx.vertex(r.c.x,r.c.y,r.c.z,r.uvC.x,r.uvC.y)):(this.gfx.vertex(r.a.x,r.a.y,r.a.z),this.gfx.vertex(r.b.x,r.b.y,r.b.z),this.gfx.vertex(r.c.x,r.c.y,r.c.z))}this.gfx.endShape()},triangle:function(t,e){var i=function(){return void 0!==t.a&&void 0!==t.b&&void 0!==t.c?void 0!==t.a.x:!1},n=function(){return i()?void 0!==t.a.z:!1};if((e||void 0===e)&&this.gfx.beginShape(this.app.TRIANGLES),n()){var s=t.computeNormal();this.gfx.normal(s.x,s.y,s.z),this.gfx.vertex(t.a.x,t.a.y,t.a.z),this.gfx.vertex(t.b.x,t.b.y,t.b.z),this.gfx.vertex(t.c.x,t.c.y,t.c.z)}else this.gfx.vertex(t.a.x,t.a.y),this.gfx.vertex(t.b.x,t.b.y),this.gfx.vertex(t.c.x,t.c.y);(e||void 0===e)&&this.gfx.endShape()},vertex:function(t){void 0===t.z?this.gfx.vertex(t.x,t.y):this.gfx.vertex(t.x,t.y,t.z)}},i.exports=o});