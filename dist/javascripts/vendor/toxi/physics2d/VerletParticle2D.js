define(["require","exports","module","../internals","../geom/Vec2D"],function(t,e,i){var n=t("../internals"),s=t("../geom/Vec2D"),r=function(t,e,i){this.force=new s,n.tests.hasXY(t)&&(n.tests.isVerletParticle2D(t)?(e=t.y,i=t.weight,t=t.x,this.isLocked=t.isLocked):void 0===e?(e=t.y,i=1,t=t.x):(i=e,e=t.y,t=t.x)),s.apply(this,[t,e]),this.isLocked=!1,this.prev=new s(this),this.temp=new s,i=i||1,this.setWeight(i)};n.extend(r,s),r.prototype.addBehavior=function(t,e){if(void 0===this.behaviors&&(this.behaviors=[]),void 0===t)throw{name:"TypeError",message:"behavior was undefined"};return e=void 0===e?1:e,t.configure(e),this.behaviors.push(t),this},r.prototype.addConstraint=function(t){return void 0===this.constraints&&(this.constraints=[]),this.constraints.push(t),this},r.prototype.addForce=function(t){return this.force.addSelf(t),this},r.prototype.addVelocity=function(t){return this.prev.subSelf(t),this},r.prototype.applyBehaviors=function(){if(void 0!==this.behaviors){var t=0;for(t=0;this.behaviors.length>t;t++)this.behaviors[t].applyBehavior(this)}},r.prototype.applyConstraints=function(){if(void 0!==this.constraints){var t=0;for(t=0;this.constraints.length>t;t++)this.constraints[t].applyConstraint(this)}},r.prototype.clearForce=function(){return this.force.clear(),this},r.prototype.clearVelocity=function(){return this.prev.set(this),this},r.prototype.getInvWeight=function(){return this.invWeight},r.prototype.getPreviousPosition=function(){return this.prev},r.prototype.getVelocity=function(){return this.sub(this.prev)},r.prototype.getWeight=function(){return this.weight},r.prototype.lock=function(){return this.isLocked=!0,this},r.prototype.removeAllBehaviors=function(){return this.behaviors=[],this},r.prototype.removeAllConstraints=function(){return this.constraints=[],this},r.prototype.removeBehavior=function(t){return n.removeItemFrom(t,this.behaviors)},r.prototype.removeConstraint=function(t){return n.removeItemFrom(t,this.constraints)},r.prototype.scaleVelocity=function(t){return this.prev.interpolateToSelf(this,1-t),this},r.prototype.setPreviousPosition=function(t){return this.prev.set(t),this},r.prototype.setWeight=function(t){this.weight=t,this.invWeight=0!==t?1/t:0},r.prototype.unlock=function(){return this.clearVelocity(),this.isLocked=!1,this},r.prototype.update=function(){if(!this.isLocked){var t=this;this.applyBehaviors(),function(){t.temp.set(t),t.addSelf(t.sub(t.prev).addSelf(t.force.scale(t.weight))),t.prev.set(t.temp),t.force.clear()}(),this.applyConstraints()}},i.exports=r});