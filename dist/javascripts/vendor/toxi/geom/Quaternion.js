define(["require","exports","module","../math/mathUtils","./Matrix4x4"],function(t,e,i){var n=t("../math/mathUtils"),r=t("./Matrix4x4"),s=function(t,e,i,n){4==arguments.length?(this.w=t,this.x=e,this.y=i,this.z=n):2==arguments.length?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=t):1==arguments.length&&(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z)};s.prototype={add:function(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},copy:function(){return new s(this.w,this.x,this.y,this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},getConjugate:function(){var t=new s;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=w,t},identity:function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},interpolateTo:function(t,e,i){return 3==arguments.length?this.copy().interpolateTo(t,i.interpolate(0,1,e)):this.copy().interpolateToSelf(t,e)},interpolateToSelf:function(t,e,i){3==arguments.length&&(e=i.interpolate(0,1,e));var r,s,o=n.clip(this.dot(t),-1,1);if(1-o>=n.EPS){var a=Math.acos(o),h=1/Math.sin(a);r=Math.sin(a*(1-e))*h,s=Math.sin(a*e)*h}else r=1-e,s=e;return 0>o?(this.w=r*this.w-s*t.w,this.x=r*this.x-s*t.x,this.y=r*this.y-s*t.y,this.z=r*this.z-s*t.z):(this.w=r*w+s*t.w,this.x=r*x+s*t.x,this.y=r*y+s*t.y,this.z=r*z+s*t.z),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},multiply:function(t){var e=new s;return e.w=this.w*t.w-x*t.x-y*t.y-z*t.z,e.x=this.w*t.x+x*t.w+y*t.z-z*t.y,e.y=this.w*t.y+y*t.w+z*t.x-x*t.z,e.z=this.w*t.z+z*t.w+x*t.y-y*t.x,e},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>n.EPS&&(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},scale:function(t){return new s(this.x*t,this.y*t,this.z*t,this.w*t)},scaleSelf:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},set:function(t,e,i,n){return 4==arguments.length?(this.w=t,this.x=e,this.y=i,this.z=n):2==arguments.length?(this.w=t,this.x=v.x,this.y=v.y,this.z=v.z):(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z),this},sub:function(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},toArray:function(){return[this.w,this.x,this.y,this.z]},toAxisAngle:function(){var t=[],e=Math.sqrt(1-this.w*this.w);return e=n.EPS>e?1:1/e,t[0]=2*Math.acos(this.w),t[1]=this.x*e,t[2]=this.y*e,t[3]=this.z*e,t},toMatrix4x4:function(t){void 0===t&&(t=new r);var e=this.x+this.x,i=this.y+this.y,n=this.z+this.z,s=this.x*e,o=this.x*i,a=this.x*n,h=this.y*i,u=this.y*n,c=this.z*n,l=this.w*e,d=this.w*i,f=this.w*n;return t.set(1-(h+c),o-f,a+d,0,o+f,1-(s+c),u-l,0,a-d,u+l,1-(s+h),0,0,0,0,1)},toString:function(){return"{axis: ["+this.x+","+this.y+","+this.z+"], w: "+this.w+"}"}},s.DOT_THRESHOLD=.9995,s.createFromAxisAngle=function(t,e){e*=.5;var i=n.sin(e),r=n.cos(e),o=new s(r,t.getNormalizedTo(i));return o},s.createFromEuler=function(t,e,i){t*=.5,e*=.5,i*=.5;var r=n.sin(t),o=n.cos(t),a=n.sin(e),h=n.cos(e),u=n.sin(i),c=n.cos(i),l=o*h,d=r*a,f=new s;return f.x=u*l-c*d,f.y=c*r*h+u*o*a,f.z=c*o*a-u*r*h,f.w=c*l+u*d,f},s.createFromMatrix=function(t){var e=0,i=[],n=t.matrix[0][0]+t.matrix[1][1]+t.matrix[2][2];if(n>0)e=Math.sqrt(n+1),i[3]=.5*e,e=.5/e,i[0]=t.matrix[1][2]-t.matrix[2][1]*e,i[1]=t.matrix[2][0]-t.matrix[0][2]*e,i[2]=t.matrix[0][1]-t.matrix[1][0]*e;else{var r=[1,2,0],o=0,a=0,h=0;t.matrix[1][1]>t.matrix[0][0]&&(o=1),t.matrix[2][2]>t.matrix[o][o]&&(o=2),a=r[o],h=r[a],e=Math.sqrt(t.matrix[o][o]-(t.matrix[a][a]+t.matrix[h][h])+1),i[o]=.5*e,e=.5/e,i[3]=(t.matrix[a][h]-t.matrix[h][a])*e,i[a]=(t.matrix[o][a]+t.matrix[a][o])*e,i[h]=(t.matrix[o][h]+t.matrix[h][o])*e}return new s(i[3],i[0],i[1],i[2])},s.getAlignmentQuat=function(t,e){var i=t.getNormalized(),n=e.cross(i),r=n.magnitude()+1e-4,s=Math.atan2(r,e.dot(i));return this.createFromAxisAngle(n,s)},i.exports=s});