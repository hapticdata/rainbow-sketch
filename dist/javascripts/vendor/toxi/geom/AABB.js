define(["require","exports","module","../internals","../math/mathUtils","./Vec2D","./Vec3D","./mesh/meshCommon"],function(t,e,n){var i=t("../internals"),r=t("./Vec3D"),s=t("./Vec2D"),o=t("../math/mathUtils"),a=function(t,e){void 0===t?(r.call(this),this.setExtent(new r)):"number"==typeof t?(r.call(this,new r),this.setExtent(t)):i.tests.hasXYZ(t)&&(r.call(this,t),void 0===e&&i.tests.isAABB(t)?this.setExtent(t.getExtent()):"number"==typeof e?this.setExtent(new r(e,e,e)):this.setExtent(e))};i.extend(a,r),a.fromMinMax=function(t,e){var n=r.min(t,e),i=r.max(t,e);return new a(n.interpolateTo(i,.5),i.sub(n).scaleSelf(.5))},a.prototype.containsPoint=function(t){return t.isInAABB(this)},a.prototype.copy=function(){return new a(this)},a.prototype.getExtent=function(){return this.extent.copy()},a.prototype.getMax=function(){return this.max.copy()},a.prototype.getMin=function(){return this.min.copy()},a.prototype.getNormalForPoint=function(t){t=t.sub(this);var e=this.extent.sub(t.getAbs()),n=t.getSignum(),i=r.X_AXIS.scale(n.x),s=e.x;return s>e.y&&(s=e.y,i=r.Y_AXIS.scale(n.y)),s>e.z&&(i=r.Z_AXIS.scale(n.z)),i},a.prototype.includePoint=function(t){return this.min.minSelf(t),this.max.maxSelf(t),this.set(this.min.interpolateTo(this.max,.5)),this.extent.set(this.max.sub(this.min).scaleSelf(.5)),this},a.prototype.intersectsBox=function(t){var e=t.sub(this);return Math.abs(e.x)<=this.extent.x+t.extent.x&&Math.abs(e.y)<=this.extent.y+t.extent.y&&Math.abs(e.z)<=this.extent.z+t.extent.z},a.prototype.intersectsRay=function(t,e,n){var i=t.getDirection().reciprocal(),r=0>i.x,s=0>i.y,o=0>i.z,a=r?this.max:this.min,u=(a.x-t.x)*i.x;a=r?this.min:this.max;var h=(a.x-t.x)*i.x;a=s?this.max:this.min;var c=(a.y-t.y)*i.y;a=s?this.min:this.max;var l=(a.y-t.y)*i.y;if(u>l||c>h)return null;c>u&&(u=c),h>l&&(h=l),a=o?this.max:this.min;var d=(a.z-t.z)*i.z;a=o?this.min:this.max;var f=(a.z-t.z)*i.z;return u>f||d>h?null:(d>u&&(u=d),h>f&&(h=f),n>u&&h>e?t.getPointAtDistance(u):void 0)},a.prototype.intersectsSphere=function(t,e){1==arguments.length&&(e=t.radius);var n,i=0;return t.x<this.min.x?(n=t.x-this.min.x,i=n*n):t.x>this.max.x&&(n=t.x-this.max.x,i+=n*n),t.y<this.min.y?(n=t.y-this.min.y,i+=n*n):t.y>this.max.y&&(n=t.y-this.max.y,i+=n*n),t.z<this.min.z?(n=t.z-this.min.z,i+=n*n):t.z>this.max.z&&(n=t.z-this.max.z,i+=n*n),e*e>=i},a.prototype.intersectsTriangle=function(t){var e,n,i,r,s,a,u,h;if(e=t.a.sub(this),n=t.b.sub(this),i=t.c.sub(this),s=n.sub(e),a=i.sub(n),u=e.sub(i),h=s.getAbs(),this.testAxis(s.z,-s.y,h.z,h.y,e.y,e.z,i.y,i.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-s.z,s.x,h.z,h.x,e.x,e.z,i.x,i.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(s.y,-s.x,h.y,h.x,n.x,n.y,i.x,i.y,this.extent.x,this.extent.y))return!1;if(h=a.getAbs(),this.testAxis(a.z,-a.y,h.z,h.y,e.y,e.z,i.y,i.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-a.z,a.x,h.z,h.x,e.x,e.z,i.x,i.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(a.y,-a.x,h.y,h.x,e.x,e.y,n.x,n.y,this.extent.x,this.extent.y))return!1;if(h=u.getAbs(),this.testAxis(u.z,-u.y,h.z,h.y,e.y,e.z,n.y,n.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-u.z,u.x,h.z,h.x,e.x,e.z,n.x,n.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(u.y,-u.x,h.y,h.x,n.x,n.y,i.x,i.y,this.extent.x,this.extent.y))return!1;if(o.min(e.x,n.x,i.x)>this.extent.x||o.max(e.x,n.x,i.x)<-this.extent.x)return!1;if(o.min(e.y,n.y,i.y)>this.extent.y||o.max(e.y,n.y,i.y)<-this.extent.y)return!1;if(o.min(e.z,n.z,i.z)>this.extent.z||o.max(e.z,n.z,i.z)<-this.extent.z)return!1;r=s.cross(a);var c=-r.dot(e);return this.planeBoxOverlap(r,c,this.extent)?!0:!1},a.prototype.planeBoxOverlap=function(t,e,n){var i=new r,s=new r;return t.x>0?(i.x=-n.x,s.x=n.x):(i.x=n.x,s.x=-n.x),t.y>0?(i.y=-n.y,s.y=n.y):(i.y=n.y,s.y=-n.y),t.z>0?(i.z=-n.z,s.z=n.z):(i.z=n.z,s.z=-n.z),t.dot(i)+e>0?!1:t.dot(s)+e>=0?!0:!1},a.prototype.set=function(t,e,n){return i.tests.isAABB(t)?(this.extent.set(t.extent),r.set.apply(this,[t])):(i.tests.hasXYZ(t)&&(e=t.y,n=t.z,t=t.a),this.x=t,this.y=e,this.z=n,this.updateBounds(),this)},a.prototype.setExtent=function(t){return this.extent=t.copy(),this.updateBounds()},a.prototype.testAxis=function(t,e,n,i,r,s,o,a,u,h){var c,l,d=t*r+e*s,f=t*o+e*a;f>d?(c=d,l=f):(c=f,l=d);var p=n*u+i*h;return c>p||-p>l},a.prototype.toMesh=function(e){if(void 0===e){var n=t("./mesh/meshCommon").TriangleMesh;e=new n("aabb",8,12)}var i=this.min,o=this.max,a=new r(i.x,i.y,o.z),u=new r(o.x,i.y,o.z),h=new r(o.x,i.y,i.z),c=new r(i.x,o.y,i.z),l=new r(i.x,o.y,o.z),d=new r(o.x,o.y,i.z),f=new s(0,0),p=new s(1,0),m=new s(1,1),g=new s(0,1);return e.addFace(i,a,l,g,m,p),e.addFace(i,l,c,g,p,f),e.addFace(a,u,o,g,m,p),e.addFace(a,o,l,g,p,f),e.addFace(u,h,d,g,m,p),e.addFace(u,d,o,g,p,f),e.addFace(h,i,c,g,m,p),e.addFace(h,c,d,g,p,f),e.addFace(c,l,d,f,g,p),e.addFace(l,o,d,g,m,p),e.addFace(i,h,a,g,m,f),e.addFace(a,h,u,f,m,p),e},a.prototype.toString=function(){return"<aabb> pos: "+r.prototype.toString.call(this)+" ext: "+(""+this.extent)},a.prototype.updateBounds=function(){return void 0!==this.extent&&(this.min=this.sub(this.extent),this.max=this.add(this.extent)),this},n.exports=a});