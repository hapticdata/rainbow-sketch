define(["require","exports","module","./Vec2D","../internals","./BernsteinPolynomial"],function(t,e,i){var n=t("./Vec2D"),r=t("../internals"),s=t("./BernsteinPolynomial"),o=function(t,e,i){1!==arguments.length||r.isArray(t)||"object"!=typeof t||(e=e||t.bernsteinPoly,i=i||t.tightness,t=t.points);var s,a=0;if(this.pointList=[],"number"!=typeof i&&(i=o.DEFAULT_TIGHTNESS),this.setTightness(i),this.bernstein=e,void 0!==t)for(a=0,s=t.length;s>a;a++)this.add(t[a].copy());for(this.coeffA=[],this.delta=[],this.bi=[],a=0;this.numP>a;a++)this.coeffA[a]=new n,this.delta[a]=new n,this.bi[a]=0;this.bi=[]};o.prototype={add:function(t){return this.pointList.push(t.copy()),this.numP=this.pointList.length,this},computeVertices:function(t){this.updateCoefficients(),(void 0===this.bernstein||this.bernstein.resolution!=t)&&(this.bernstein=new s(t));var e=this.bernstein;this.vertices=[],this.findCPoints();for(var i=new n,r=new n,o=0;this.numP-1>o;o++){var a=this.points[o],h=this.points[o+1];i.set(this.delta[o]).addSelf(a),r.set(h).subSelf(this.delta[o+1]);for(var u=0;e.resolution>u;u++){var c=a.x*e.b0[u]+i.x*e.b1[u]+r.x*e.b2[u]+h.x*e.b3[u],l=a.y*e.b0[u]+i.y*e.b1[u]+r.y*e.b2[u]+h.y*e.b3[u];this.vertices.push(new n(c,l))}}return this.vertices},findCPoints:function(){this.bi[1]=-.25;var t,e,i,n;for(e=this.pointList[0],i=this.pointList[2],n=this.delta[0],this.coeffA[1].set((i.x-e.x-n.x)*this.tightness,(i.y-e.y-n.y)*this.tightness),t=2;this.numP-1>t;t++)this.bi[t]=-1/(this.invTightness+this.bi[t-1]),this.coeffA[t].set(-(this.points[t+1].x-this.points[t-1].x-this.coeffA[t-1].x)*this.bi[t],-(this.points[t+1].y-this.points[t-1].y-this.coeffA[t-1].y)*this.bi[t]);for(t=this.numP-2;t>0;t--)this.delta[t].set(this.coeffA[t].x+this.delta[t+1].x*this.bi[t],this.coeffA[t].y+this.delta[t+1].y*this.bi[t])},getDecimatedVertices:function(t,e){void 0===e&&(e=!0),(void 0===this.vertices||2>this.vertices.length)&&this.computeVertices(o.DEFAULT_RES);for(var i=this.getEstimatedArcLength(),n=[],r=t/i,s=0,a=0;1>a;a+=r){for(var h=a*i;h>=this.arcLenIndex[s];)s++;var u=this.vertices[s-1],c=this.vertices[s],l=(h-this.arcLenIndex[s-1])/(this.arcLenIndex[s]-this.arcLenIndex[s-1]),d=u.interpolateTo(c,l);this.uniform.push(d)}return e&&n.push(this.vertices[this.vertices.length-1]),n},getEstimatedArcLength:function(){(void 0===this.arcLenIndex||void 0!==this.arcLenIndex&&this.arcLenIndex.length!=this.vertices.length)&&(this.arcLenIndex=[]);for(var t=0,e=1;this.arcLenIndex.length>e;e++){var i=this.vertices[e-1],n=this.vertices[e];t+=i.distanceTo(n),this.arcLenIndex[e]=t}return t},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(t){return this.pointList=t.slice(0),this},setTightness:function(t){return this.tightness=t,this.invTightness=1/this.tightness,this},updateCoefficients:function(){if(this.numP=this.pointList.length,void 0===this.points||void 0!==this.points&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var t=0;this.numP>t;t++)this.coeffA[t]=new n,this.delta[t]=new n;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},o.DEFAULT_TIGHTNESS=.25,o.DEFAULT_RES=16,i.exports=o});