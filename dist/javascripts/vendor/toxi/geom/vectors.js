define(["require","exports","module","../math/mathUtils","../internals"],function(t,e){var i=t("../math/mathUtils"),n=t("../internals"),s=n.tests.hasXY,r=n.tests.isRect,o=function(t,e){s(t)?(e=t.y,t=t.x):(void 0===t&&(t=0),void 0===e&&(e=0)),this.x=t,this.y=e};o.Axis={X:{getVector:function(){return o.X_AXIS},toString:function(){return"Vec2D.Axis.X"}},Y:{getVector:function(){return o.Y_AXIS},toString:function(){return"Vec2D.Axis.Y"}}};var a=function(t,e){return s(t)?(e=t.y,t=t.x):void 0!==t&&void 0===e?e=t:void 0===t?t=0:void 0===e&&(e=0),{x:t,y:e}};o.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},add:function(t,e){var i=new o(t,e);return i.x+=this.x,i.y+=this.y,i},addSelf:function(t,e){var i=a(t,e);return this.x+=i.x,this.y+=i.y,this},angleBetween:function(t,e){if(void 0===e)return this.dot(t),Math.acos(this.dot(t));var i=e?this.getNormalized().dot(t.getNormalized()):this.dot(t);return Math.acos(i)},clear:function(){return this.x=this.y=0,this},compareTo:function(t){return this.x==t.x&&this.y==t.y?0:this.magSquared()-t.magSquared()},constrain:function(t,e){return s(t)&&s(e)?(this.x=i.clip(this.x,t.x,e.x),this.y=i.clip(this.y,t.y,e.y)):r(t)&&(this.x=i.clip(this.x,t.x,t.x+t.width),this.y=i.clip(this.y,t.y,t.y+t.height)),this},copy:function(){return new o(this)},cross:function(t){return this.x*t.y-this.y*t.x},distanceTo:function(t){if(void 0!==t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}return 0/0},distanceToSquared:function(t){if(void 0!==t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}return 0/0},dot:function(t){return this.x*t.x+this.y*t.y},equals:function(t){return s(t)?this.x==t.x&&this.y==t.y:!1},equalsWithTolerance:function(t,e){return s(t)?e>i.abs(this.x-t.x)&&e>i.abs(this.y-t.y)?!0:!1:!1},floor:function(){return this.x=i.floor(this.x),this.y=i.floor(this.y),this},frac:function(){return this.x-=i.floor(this.x),this.y-=i.floor(this.y),this},getAbs:function(){return new o(this).abs()},getComponent:function(t){return"number"==typeof t&&(t=0===t?o.Axis.X:o.Axis.Y),t==o.Axis.X?this.x:t==o.Axis.Y?this.y:0},getConstrained:function(t){return new o(this).constrain(t)},getFloored:function(){return new o(this).floor()},getFrac:function(){return new o(this).frac()},getInverted:function(){return new o(-this.x,-this.y)},getLimited:function(t){return this.magSquared()>t*t?this.getNormalizedTo(t):new o(this)},getNormalized:function(){return new o(this).normalize()},getNormalizedTo:function(t){return new o(this).normalizeTo(t)},getPerpendicular:function(){return new o(this).perpendicular()},getReciprocal:function(){return new o(this).reciprocal()},getReflected:function(t){return new o(this).reflect(t)},getRotated:function(t){return new o(this).rotate(t)},getSignum:function(){return new o(this).signum()},heading:function(){return Math.atan2(this.y,this.x)},interpolateTo:function(t,e,i){return void 0===i?new o(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e):new o(i.interpolate(this.x,t.x,e),i.interpolate(this.y,t.y,e))},interpolateToSelf:function(t,e,i){return void 0===i?(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e):(this.x=i.interpolate(this.x,t.x,e),this.y=i.interpolate(this.y,t.y,e)),this},invert:function(){return this.x*=-1,this.y*=-1,this},isInCircle:function(t,e){var i=this.sub(t).magSquared();return e*e>=i},isInRectangle:function(t){return this.x<t.x||this.x>t.x+t.width?!1:this.y<t.y||this.y>t.y+t.height?!1:!0},isInTriangle:function(t,e,n){var s=this.sub(t).normalize(),r=this.sub(e).normalize(),o=this.sub(n).normalize(),a=Math.acos(s.dot(r));return a+=Math.acos(r.dot(o)),a+=Math.acos(o.dot(s)),.005>=Math.abs(a-i.TWO_PI)},isMajorAxis:function(t){var e=Math.abs(this.x),i=Math.abs(this.y),n=1-t;return e>n?t>i:i>n?t>e:!1},isZeroVector:function(){return Math.abs(this.x)<i.EPS&&Math.abs(this.y)<i.EPS},jitter:function(t,e){var n=a(t,e);return this.x+=i.normalizedRandom()*n.x,this.y+=i.normalizedRandom()*n.y,this},limit:function(t){return this.magSquared()>t*t?this.normalize().scaleSelf(t):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSquared:function(){return this.x*this.x+this.y*this.y},max:function(t){return new o(i.max(this.x,t.x),i.max(this.y,t.y))},maxSelf:function(t){return this.x=i.max(this.x,t.x),this.y=i.max(this.y,t.y),this},min:function(t){return new o(i.min(this.x,t.x),i.min(this.y,t.y))},minSelf:function(t){return this.x=i.min(this.x,t.x),this.y=i.min(this.y,t.y),this},normalize:function(){var t=this.x*this.x+this.y*this.y;return t>0&&(t=1/Math.sqrt(t),this.x*=t,this.y*=t),this},normalizeTo:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e>0&&(e=t/e,this.x*=e,this.y*=e),this},perpendicular:function(){var t=this.x;return this.x=-this.y,this.y=t,this},positiveHeading:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return this.y>=0?Math.acos(this.x/t):Math.acos(-this.x/t)+i.PI},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this},reflect:function(t){return this.set(t.scale(2*this.dot(t)).subSelf(this))},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y;return this.y=i*this.x+e*this.y,this.x=n,this},roundToAxis:function(){return.5>Math.abs(this.x)?this.x=0:(this.x=0>this.x?-1:1,this.y=0),.5>Math.abs(this.y)?this.y=0:(this.y=0>this.y?-1:1,this.x=0),this},scale:function(t,e){var i=a(t,e);return new o(this.x*i.x,this.y*i.y)},scaleSelf:function(t,e){var i=a(t,e);return this.x*=i.x,this.y*=i.y,this},set:function(t,e){var i=a(t,e);return this.x=i.x,this.y=i.y,this},setComponent:function(t,e){return"number"==typeof t&&(t=0===t?o.Axis.X:o.Axis.Y),t===o.Axis.X?this.x=e:t===o.Axis.Y&&(this.y=e),this},signum:function(){return this.x=0>this.x?-1:0===this.x?0:1,this.y=0>this.y?-1:0===this.y?0:1,this},sub:function(t,e){var i=a(t,e);return new o(this.x-i.x,this.y-i.y)},subSelf:function(t,e){var i=a(t,e);return this.x-=i.x,this.y-=i.y,this},tangentNormalOfEllipse:function(t,e){var i=this.sub(t),n=e.x*e.x,s=e.y*e.y;return new o(i.x/n,i.y/s).normalize()},toArray:function(){return[this.x,this.y]},toCartesian:function(){var t=this.x*Math.cos(this.y);return this.y=this.x*Math.sin(this.y),this.x=t,this},toPolar:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return this.y=Math.atan2(this.y,this.x),this.x=t,this},toString:function(){var t="{x:"+this.x+", y:"+this.y+"}";return t}},o.prototype.bisect=function(e){var i=t("./Vec3D"),n=this.sub(e),s=this.add(e),r=n.dot(s);return new i(n.x,n.y,-r/2)},o.prototype.to3DXY=function(){var e=t("./Vec3D");return new e(this.x,this.y,0)},o.prototype.to3DXZ=function(){var e=t("./Vec3D");return new e(this.x,0,this.y)},o.prototype.to3DYZ=function(){var e=t("./Vec3D");return new e(0,this.x,this.y)},o.X_AXIS=new o(1,0),o.Y_AXIS=new o(0,1),o.ZERO=new o,o.MIN_VALUE=new o(Number.MIN_VALUE,Number.MIN_VALUE),o.MAX_VALUE=new o(Number.MAX_VALUE,Number.MAX_VALUE),o.fromTheta=function(t){return new o(Math.cos(t),Math.sin(t))},o.max=function(t,e){return new o(i.max(t.x,e.x),i.max(t.y,e.y))},o.min=function(t,e){return new o(i.min(t.x,e.x),i.min(t.y,e.y))},o.randomVector=function(){var t=new o(2*Math.random()-1,2*Math.random()-1);return t.normalize()};var h=function(t,e,i){n.tests.hasXYZ(t)?(this.x=t.x,this.y=t.y,this.z=t.z):void 0===t?(this.x=0,this.y=0,this.z=0):(this.x=t,this.y=e,this.z=i)};h.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},add:function(t,e,i){return n.tests.hasXYZ(t)?new h(this.x+t.x,this.y+t.y,this.z+t.z):new h(this.x+t,this.y+e,this.z+i)},addSelf:function(t,e,i){return void 0!==t&&void 0!==e&&void 0!==i?(this.x+=t,this.y+=e,this.z+=i):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this},angleBetween:function(t,e){var i;return i=e?this.getNormalized().dot(t.getNormalized()):this.dot(t),Math.acos(i)},clear:function(){return this.x=this.y=this.z=0,this},compareTo:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z?0:this.magSquared()-t.magSqaured()},constrain:function(t,e){var s;return n.tests.isAABB(t)?(e=t.getMax(),s=t.getMin()):s=t,this.x=i.clip(this.x,s.x,e.x),this.y=i.clip(this.y,s.y,e.y),this.z=i.clip(this.z,s.z,e.z),this},copy:function(){return new h(this)},cross:function(t){return new h(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},crossInto:function(t){var e=t.x,i=t.y,n=t.z;return result.x=this.y*n-i*this.z,result.y=this.z*e-n*this.x,result.z=this.x*i-e*this.y,result},crossSelf:function(t){var e=this.y*t.z-t.y*this.z,i=this.z*t.x-t.z*this.x;return this.z=this.x*t.y-t.x*this.y,this.y=i,this.x=e,this},distanceTo:function(t){if(void 0!==t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)}return 0/0},distanceToSquared:function(t){if(void 0!==t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}return 0/0},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},equals:function(t){return n.tests.hasXYZ(t)?this.x==t.x&&this.y==t.y&&this.z==t.z:!1},equalsWithTolerance:function(t,e){return e>Math.abs(this.x-t.x)&&e>Math.abs(this.y-t.y)&&e>Math.abs(this.z-t.z)?!0:!1},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},frac:function(){return this.x-=Math.floor(this.x),this.y-=Math.floor(this.y),this.z-=Math.floor(this.z),this},getAbs:function(){return new h(this).abs()},getComponent:function(t){switch("number"==typeof t&&(t=t===h.Axis.X?0:t===h.Axis.Y?1:2),t){case 0:return this.x;case 1:return this.y;case 2:return this.z}},getConstrained:function(t){return new h(this).constrain(t)},getFloored:function(){return new h(this).floor()},getFrac:function(){return new h(this).frac()},getInverted:function(){return new h(-this.x,-this.y,-this.z)},getLimited:function(t){return this.magSquared()>t*t?this.getNormalizedTo(t):new h(this)},getNormalized:function(){return new h(this).normalize()},getNormalizedTo:function(t){return new h(this).normalizeTo(t)},getReciprocal:function(){return this.copy().reciprocal()},getReflected:function(t){return this.copy().reflect(t)},getRotatedAroundAxis:function(t,e){return new h(this).rotateAroundAxis(t,e)},getRotatedX:function(t){return new h(this).rotateX(t)},getRotatedY:function(t){return new h(this).rotateY(t)},getRotatedZ:function(t){return new h(this).rotateZ(t)},getSignum:function(){return new h(this).signum()},headingXY:function(){return Math.atan2(this.y,this.x)},headingXZ:function(){return Math.atan2(this.z,this.x)},headingYZ:function(){return Math.atan2(this.y,this.z)},immutable:function(){return this},interpolateTo:function(t,e,i){return void 0===i?new h(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e,this.z+(t.z-this.z)*e):new h(i.interpolate(this.y,t.y,e),i.interpolate(this.y,t.y,e),i.interpolate(this.z,t.z,e))},interpolateToSelf:function(t,e,i){return void 0===i?(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e):(this.x=i.interpolate(this.x,t.x,e),this.y=i.interpolate(this.y,t.y,e),this.z=i.interpolate(this.z,t.z,e)),this},invert:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},isInAABB:function(t,e){if(e){var i=e.x;if(this.x<t.x-i||this.x>t.x+i)return!1;if(i=e.y,this.y<t.y-i||this.y>t.y+i)return!1;if(i=e.y,this.z<t.z-i||this.y>t.z+i)return!1}return!0},isMajorAxis:function(t){var e=i.abs(this.x),n=i.abs(this.y),s=i.abs(this.z),r=1-t;if(e>r){if(t>n)return t>s}else if(n>r){if(t>e)return t>s}else if(s>r&&t>e)return t>n;return!1},isZeroVector:function(){return Math.abs(this.x)<i.EPS&&Math.abs(this.y)<i.EPS&&i.abs(this.z)<i.EPS},jitter:function(t,e,n){return(void 0===e||void 0===n)&&(e=n=t),this.x+=i.normalizedRandom()*t,this.y+=i.normalizedRandom()*e,this.z+=i.normalizedRandom()*n,this},limit:function(t){return this.magSquared()>t*t?this.normalize().scaleSelf(t):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},magSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},maxSelf:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},minSelf:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},modSelf:function(t,e,i){return(void 0===e||void 0===i)&&(e=i=t),this.x%=t,this.y%=e,this.z%=i,this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t,this.x*=t,this.y*=t,this.z*=t),this},normalizeTo:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e>0&&(e=t/e,this.x*=e,this.y*=e,this.z*=e),this},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},reflect:function(t){return this.set(t.scale(2*this.dot(t)).subSelf(this))},rotateAroundAxis:function(t,e){var i=t.x,n=t.y,s=t.z,r=i*this.x,o=i*this.y,a=i*this.z,h=n*this.x,u=n*this.y,c=n*this.z,l=s*this.x,d=s*this.y,f=s*this.z,p=Math.sin(e),m=Math.cos(e),g=i*(r+u+f)+(this.x*(n*n+s*s)-i*(u+f))*m+(-d+c)*p,y=n*(r+u+f)+(this.y*(i*i+s*s)-n*(r+f))*m+(l-a)*p,x=s*(r+u+f)+(this.z*(i*i+n*n)-s*(r+u))*m+(-h+o)*p;return this.x=g,this.y=y,this.z=x,this},rotateX:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.z-i*this.y;return this.y=i*this.z+e*this.y,this.z=n,this},rotateY:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.z;return this.z=i*this.x+e*this.z,this.x=n,this},rotateZ:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y;return this.y=i*this.x+e*this.y,this.x=n,this},roundToAxis:function(){return.5>Math.abs(this.x)?this.x=0:(this.x=0>this.x?-1:1,this.y=this.z=0),.5>Math.abs(this.y)?this.y=0:(this.y=0>this.y?-1:1,this.x=this.z=0),.5>Math.abs(this.z)?this.z=0:(this.z=0>this.z?-1:1,this.x=this.y=0),this},scale:function(t,e,i){return n.tests.hasXYZ(t)?new h(this.x*t.x,this.y*t.y,this.z*t.z):((void 0===e||void 0===i)&&(e=i=t),new h(this.x*t,this.y*e,this.z*i))},scaleSelf:function(t,e,i){return n.tests.hasXYZ(t)?(this.x*=t.x,this.y*=t.y,this.z*=t.z,this):((void 0===e||void 0===i)&&(e=i=t),this.x*=t,this.y*=e,this.z*=i,this)},set:function(t,e,i){return n.tests.hasXYZ(t)?(this.x=t.x,this.y=t.y,this.z=t.z,this):((void 0===e||void 0===i)&&(e=i=t),this.x=t,this.y=e,this.z=i,this)},setXY:function(t){return this.x=t.x,this.y=t.y,this},shuffle:function(t){for(var e,i=0;t>i;i++)switch(Math.floor(3*Math.random())){case 0:e=this.x,this.x=this.y,this.z=e;break;case 1:e=this.x,this.x=this.z,this.z=e;break;case 2:e=this.y,this.y=this.z,this.z=e}return this},signum:function(){return this.x=0>this.x?-1:0===this.x?0:1,this.y=0>this.y?-1:0===this.y?0:1,this.z=0>this.z?-1:0===this.z?0:1,this},sub:function(t,e,i){return n.tests.hasXYZ(t)?new h(this.x-t.x,this.y-t.y,this.z-t.z):((void 0===e||void 0===i)&&(e=i=t),new h(this.x-t,this.y-e,this.z-i))},subSelf:function(t,e,i){return n.tests.hasXYZ(t)?(this.x-=t.x,this.y-=t.y,this.z-=t.z,this):((void 0===e||void 0===i)&&(e=i=t),this.x-=t,this.y-=e,this.z-=i,this)},to2DXY:function(){return new o(this.x,this.y)},to2DXZ:function(){return new o(this.x,this.z)},to2DYZ:function(){return new o(this.y,this.z)},toArray:function(){return[this.x,this.y,this.z]},toArray4:function(t){var e=this.toArray();return e[3]=t,e},toCartesian:function(){var t=this.x*Math.cos(this.z),e=t*Math.cos(this.y),i=this.x*Math.sin(this.z),n=t*Math.sin(this.y);return this.x=e,this.y=i,this.z=n,this},toSpherical:function(){var t=Math.abs(this.x)<=i.EPS?i.EPS:this.x,e=this.z,n=Math.sqrt(t*t+this.y*this.y+e*e);return this.z=Math.asin(this.y/n),this.y=Math.atan(e/t)+(0>t?Math.PI:0),this.x=n,this},toString:function(){return"[ x: "+this.x+", y: "+this.y+", z: "+this.z+"]"}},h.MIN_VALUE=new h(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),h.MAX_VALUE=new h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h.fromXYTheta=function(t){return new h(Math.cos(t),Math.sin(t),0)},h.fromXZTheta=function(t){return new h(Math.cos(t),0,Math.sin(t))},h.fromYZTheta=function(t){return new h(0,Math.cos(t),Math.sin(t))},h.max=function(t,e){return new h(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},h.min=function(t,e){return new h(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},h.randomVector=function(){var t=new h(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);return t.normalize()},h.ZERO=new h(0,0,0),h.X_AXIS=new h(1,0,0),h.Y_AXIS=new h(0,1,0),h.Z_AXIS=new h(0,0,1),h.Axis={X:{getVector:function(){return h.X_AXIS},toString:function(){return"Vec3D.Axis.X"}},Y:{getVector:function(){return h.Y_AXIS},toString:function(){return"Vec3D.Axis.Y"}},Z:{getVector:function(){return h.Z_AXIS},toString:function(){return"Vec3D.Axis.Z"}}},e.Vec2D=o,e.Vec3D=h});