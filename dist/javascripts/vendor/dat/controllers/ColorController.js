define(["dat/controllers/Controller","dat/dom/dom","dat/color/Color","dat/color/interpret","dat/utils/common"],function(t,e,i,n,r){function s(t,e,i,n){t.style.background="",r.each(h,function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "})}function o(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(t,h){function u(t){f(t),e.bind(window,"mousemove",f),e.bind(window,"mouseup",l)}function l(){e.unbind(window,"mousemove",f),e.unbind(window,"mouseup",l)}function c(){var t=n(this.value);t!==!1?(m.__color.__state=t,m.setValue(m.__color.toOriginal())):this.value=""+m.__color}function d(){e.unbind(window,"mousemove",p),e.unbind(window,"mouseup",d)}function f(t){t.preventDefault();var i=e.getWidth(m.__saturation_field),n=e.getOffset(m.__saturation_field),r=(t.clientX-n.left+document.body.scrollLeft)/i,s=1-(t.clientY-n.top+document.body.scrollTop)/i;return s>1?s=1:0>s&&(s=0),r>1?r=1:0>r&&(r=0),m.__color.v=s,m.__color.s=r,m.setValue(m.__color.toOriginal()),!1}function p(t){t.preventDefault();var i=e.getHeight(m.__hue_field),n=e.getOffset(m.__hue_field),r=1-(t.clientY-n.top+document.body.scrollTop)/i;return r>1?r=1:0>r&&(r=0),m.__color.h=360*r,m.setValue(m.__color.toOriginal()),!1}a.superclass.call(this,t,h),this.__color=new i(this.getValue()),this.__temp=new i(0);var m=this;this.domElement=document.createElement("div"),e.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",e.bind(this.__input,"keydown",function(t){13===t.keyCode&&c.call(this)}),e.bind(this.__input,"blur",c),e.bind(this.__selector,"mousedown",function(){e.addClass(this,"drag").bind(window,"mouseup",function(){e.removeClass(m.__selector,"drag")})});var _=document.createElement("div");r.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),r.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),r.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),r.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),r.extend(_.style,{width:"100%",height:"100%",background:"none"}),s(_,"top","rgba(0,0,0,0)","#000"),r.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),o(this.__hue_field),r.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),e.bind(this.__saturation_field,"mousedown",u),e.bind(this.__field_knob,"mousedown",u),e.bind(this.__hue_field,"mousedown",function(t){p(t),e.bind(window,"mousemove",p),e.bind(window,"mouseup",d)}),this.__saturation_field.appendChild(_),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=t,r.extend(a.prototype,t.prototype,{updateDisplay:function(){var t=n(this.getValue());if(t!==!1){var e=!1;r.each(i.COMPONENTS,function(i){return r.isUndefined(t[i])||r.isUndefined(this.__color.__state[i])||t[i]===this.__color.__state[i]?void 0:(e=!0,{})},this),e&&r.extend(this.__color.__state,t)}r.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=.5>this.__color.v||this.__color.s>.5?255:0,a=255-o;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:""+this.__temp,border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",""+this.__temp),r.extend(this.__input.style,{backgroundColor:this.__input.value=""+this.__color,color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var h=["-moz-","-o-","-webkit-","-ms-",""];return a});